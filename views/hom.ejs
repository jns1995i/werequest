<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>REGISTRAR</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Poppins:wght@100;200;300;400;500;600;700;800&display=swap">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="/color.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels"></script>
    <link rel="stylesheet" href="/user.css">
    <link rel="icon" href="/images/logo.png">
    <style>
        .horizon {
            display: flex;
            overflow-x: auto;
            white-space: nowrap;
            gap: 20px;
            padding: 15px 0;
            justify-content: start;
            scroll-snap-type: x mandatory;
            border: 1px solid rgba(255, 255, 255, 0);
            border-radius: 10px;
        }
        .horCard {
            flex: 0 0 auto;
            padding: 20px;
            width: 23%;
        }
        .details {
            max-height: 0;
            overflow: hidden;
            opacity: 0;
            transition: max-height 0.6s ease-in-out, opacity 0.8s ease-in-out, padding 0.4s ease-in-out;
            white-space: pre-line;
        }

        .details.show {
            max-height: fit-content;
            opacity: 1;
            padding: 10px 0;
        }

        .newsCard {
            transition: all 0.8s ease-in-out;
        }
        #assignDepCard {
            max-width: 0;
            max-height: 0;
            opacity: 0;
            overflow: hidden;
            position: absolute;
            z-index: 100;
        }
        #assignDepCard.active {
            max-width: 100%;
            max-height: 100%;
            opacity: 1;
            position: absolute;
            z-index: 100;
        }
        .unseen {
            max-height: 0;
            opacity: 0;
            overflow: hidden;
            transition: max-height 0.9s ease, opacity 0.6s ease;
            position: absolute;
        }
        .seen2 {
            max-height: 400px;
            opacity: 1;
            padding: 0;
            transition: max-height 0.1s ease, opacity 0.6s ease;
            position: absolute;
        }
        textarea {
            background-color: white;
        }
        .headf {
            border: none;
        }
        #statLabel {
            position: absolute;
            right: 10px;
            top: 20px;
            background-color: transparent;
            padding: 5px;
            border: 0.5px solid rgba(128, 128, 128, 0.3);
            display: none;
        }
        #TRX {
            border-radius: 10px;
            padding: 10px;
        }
        
        .annCard {
            height: auto;
            min-height: 300px;
            border-radius: 15px;
            flex-direction: column;
            justify-content: start;
            align-items: start;
            gap: 10px;
            padding: 30px !important;
            position: relative;
            margin-bottom: 24px;
            border: 0.5px green solid;
        }
        .annCard .section { justify-content: start; padding: 5px; }
        .annDate { position: absolute; top: 10px; right: 10px; width: auto; height: auto; margin-bottom: 10px; font-size: 0.8vw; }
        .annPhoto { width: 100%; height: auto; }
        .annPhoto img { width: 100%; height: 100%; border-radius: 0.5vw; }
@keyframes flashWarning {
  0%, 39% { opacity: 1; }   /* visible first half */
  70%, 100% { opacity: 0; } /* hidden second half */
}
#warning {
  animation: flashWarning 8s infinite;
  transition: opacity 0.5s ease-in-out;
}

@media screen and (max-width: 1025px) {
    .mobile {
        display: none;
    }
    .responsive {
        display: none;
    }
    body {
        padding: 0;
    }
    #MainFrame {
        flex-direction: column;
        overflow-y: auto;
        padding: 5px;
        height: 90%;
        display: block;
    }
    #VideoFrame {
        position: initial;
        width: 100%;
        height: auto !important;
        flex-direction: row !important;
        box-shadow: none;
    }
    #VideoFrame2 {
        flex-direction: row;
        gap: 8px ;
    }
    #leftVideo {
        width: 50% !important;
        display: none;
    }
    #rightVideo, #lastVideo {
        width: 50% !important;
        padding: 15px;
    }
    .annCrd {
        width: 100% !important;
    }
    #annFrame {
        padding-inline: 5% !important;
        height: auto !important;
        overflow-y: hidden;
    }
    #headFrame {
        flex-direction: column-reverse !important;
        height: auto !important;
        gap: 5px;
        margin-bottom: 5px;
    }
    #navFrame {
        display: none;
    }
    #navFrame2 {
        display: flex;
        bottom: 0;
        left: 0;
        width: 100%;
        height: auto !important;
        z-index: 600;
        justify-content: space-between;
        padding: 10px;
        color: white !important;
    }
    #navFrame2 p {
        color: white;
    }
    #titleText {
        font-size: 18px;
    }
    .EmerText {
        display: flex;
    }
    #greetings {
        justify-content: center;
    }
}
    </style>
<body class="block bgWhite relative padding0">
    <div class="height10 headPrime" id="headFrame">
        <div class=" justifyStart paddingInline20 gap10 responsive">
            <a href="/hom" class="userPhoto transition width0 h60 padding0 borderRadius500"><img src="/images/logo.jpg" alt="" class="height60 borderRadius500"></a>
            <p class="size24 str400 white">WeRequest</p>
        </div>
                <span class="flex justifyStart alignCenter gap0 snav paddingInline20 paddingBlock0 borderRadius5 width90 responsive">
                    <input type="search" id="" class="border0 width100 univ" placeholder="Search announcement">
                    <i class="fas fa-search" style="font-size: 12px;"></i>
                </span>
        <div class="paddingInline10">
            <div class="width100 height100 justifyEnd gap10" id="navFrame">
                <a href="/reqAll" class="nav white" style="background-color: rgba(255, 255, 255, 0.2);">Document Request</a>
                <a href="/prf" class="height0 width0" id="prfBtn">
                    <img src="<%= user.photo ? user.photo : '/images/profile.jpg' %>" 
                    alt="" 
                    class="borderRadius500 h50 borderPrimary" 
                    onerror="this.onerror=null; this.src='/images/profile.jpg';">
                </a>
            </div>
            <div class="width100 height100 gap5 transparent hidden" id="navFrame2">
                <div class="height0 gap5 justifyStart">
                    <div class="justifyStart gap10">
                        <a href="/hom" class="userPhoto transition h40 w40 padding0 borderRadius500"><img src="/images/logo.jpg" alt="" class="borderRadius500"></a>
                        <p class="size24 str400 colorPrimary">WeRequest</p>
                    </div>
                </div>
                <div class="height0 justifyEnd gap10">
                <a href="/reqAll" class="nav white" style="background-color: rgba(255, 255, 255, 0.2);">Document Request</a>
                <a href="/reqAll" class="nav cnav white hidden"  style="background-color: rgba(255, 255, 255, 0.2);"><i class="fas fa-file-lines"></i></a>
                    <a href="/prf" class="nav cnav headf" id="">
                        <img src="<%= user.photo ? user.photo : '/images/profile.jpg' %>" 
                        alt="" 
                        class="borderRadius500" 
                        onerror="this.onerror=null; this.src='/images/profile.jpg';">
                    </a>
                </div>
            </div>
        </div>
    </div>
    
    <div class="height90 gap20 relative alignStart" id="MainFrame">
        <div class="width100 bgSoft borderRadius10 block overflow-y1 paddingBlock20" style="padding-inline: 27%;" id="annFrame">
            <div class="height0 marginTop15 EmerText hidden">
                <span class="flex justifyStart alignCenter gap0 snav paddingInline20 paddingBlock0 borderRadius10 width90">
                    <input type="search" id="" class="border0 width100 univ" placeholder="Search announcement">
                    <i class="fas fa-search" style="font-size: 12px;"></i>
                </span>
            </div>
            <br>
            <div id="notFound" class="size20 height0 width0 padding30 borderRadius10 str500  shadowNone hidden bgSoft col">
                Sorry, No record Found!
            </div>
            <% const formatDate = (date) => {
                const currentDate = new Date();
                const diffInTime = currentDate.getTime() - date.getTime();
                const diffInDays = Math.floor(diffInTime / (1000 * 3600 * 24)); // Difference in days
            
                const options = { year: 'numeric', month: 'short', day: 'numeric' };
                const formattedDate = date.toLocaleString('en-US', options); // Only date part
                const timeOptions = { hour: 'numeric', minute: 'numeric', hour12: true }; // Only time part
                const formattedTime = date.toLocaleString('en-US', timeOptions);  // Only time part
            
                if (diffInDays === 0) {
                    return `Today • ${formattedDate} - ${formattedTime}`; // Dash separator for today
                } else if (diffInDays === 1) {
                    return `Yesterday • ${formattedDate} - ${formattedTime}`; // Dash separator for yesterday
                } else {
                    const dayName = date.toLocaleString('en-US', { weekday: 'long' });
                    return `${dayName} • ${formattedDate} - ${formattedTime}`; // Dash separator for other days
                }
            } %>
    
    <% if (announcements && announcements.length > 0) { %>
        <% announcements.forEach(ann => { %>
            <div class="card annCard darkShadow newsCard2" style="padding: 10px;">
                
                <div class="justifyBetween gap10">
                    <p class="size24 str600 width0 textCenter"><%= ann.title %></p>
                    <% if (user.position === "Punong Barangay" || user.position === "Barangay Secretary") { %>
                    <div class="height0 right gap10 width0">
                        <a href="javascript:void(0)" class="nav cnav green" onclick="editAnnouncement('<%= ann._id %>', '<%= ann.title %>', '<%= ann.description %>', '<%= ann.image %>')">
                            <i class="fas fa-edit"></i>
                        </a>                                
                        <form action="/deleteAnn/<%= ann._id %>" method="POST" onsubmit="return confirm('Are you sure you want to delete this?');" class="width0 height0 transparent vers border0 borderRadiusNone">
                            <button type="submit" class="nav cnav border0 green border0">
                                <i class="fas fa-trash"></i>
                            </button>
                        </form>
                        
                    </div>
                    <% } %>
                </div>
                <div class="height0 gap10 justifyStart">
                    <div class="section padding5 borderRadius5 bgTint9 width0 size12">
                        Posted by: 
                        <% if (ann.residentDetails) { %>
                            <%= ann.residentDetails.firstName %> <%= ann.residentDetails.lastName %>
                        <% } else { %>
                            Unknown Resident
                        <% } %>
                    </div>
                    <div class="section padding5 borderRadius5 bgTint9 width0 size12">
                        Published: <%= ann.createdAt.toDateString() %>
                    </div>
                </div>
                <div class="section mainCN">
                    <p class="width100"><%= ann.description %></p>
                </div>
                <div class="section annPhoto">
                    <% if (ann.image) { %>
                        <img src="<%= ann.image %>" alt="Announcement Image" width="100px" height="100px" class="borderPrimary">
                    <% } else { %>
                        <p>No Image Available</p>
                    <% } %>
                </div>
            </div>
        <% }); %>
    <% } else { %>
        <p>No announcements available.</p>
    <% } %>
        </div>
    </div>


    <script>
        document.addEventListener("DOMContentLoaded", function() {
        document.querySelectorAll(".showBtn").forEach(button => {
            button.addEventListener("click", function(event) {
                event.preventDefault(); // Prevent default <a> behavior
    
                let newsCard = this.closest(".newsCard"); // Get parent newsCard
                let details = newsCard.querySelector(".details"); // Get details inside the card
                let icon = this.querySelector("i"); // Get icon inside the button
    
                details.classList.toggle("show"); // Toggle visibility
                
                // Toggle icon class
                if (details.classList.contains("show")) {
                    icon.classList.remove("fa-chevron-down");
                    icon.classList.add("fa-chevron-up");
                } else {
                    icon.classList.remove("fa-chevron-up");
                    icon.classList.add("fa-chevron-down");
                }
            });
        });
    });
    
    </script>
    <script>
document.addEventListener("DOMContentLoaded", function () {
    const univInputs = document.querySelectorAll(".univ");
    const newsCards = document.querySelectorAll(".newsCard2");
    const notFoundMessage = document.getElementById("notFound");
    const searchHideDivs = document.querySelectorAll(".searchHide");

    function handleFilter(event) {
        const filter = event.target.value.toLowerCase();
        let found = false;

        if (filter === "") {
            // Reset all cards to their default display
            newsCards.forEach(card => card.style.display = "");
            notFoundMessage.style.display = "none";
            searchHideDivs.forEach(div => div.style.display = "");
            return;
        }

        // Hide .serachHide while searching
        searchHideDivs.forEach(div => div.style.display = "none");

        // Filter cards
        newsCards.forEach(card => {
            if (card.textContent.toLowerCase().includes(filter)) {
                card.style.display = "";
                found = true;
            } else {
                card.style.display = "none";
            }
        });

        notFoundMessage.style.display = found ? "none" : "flex";
    }

    univInputs.forEach(univInput => {
        univInput.addEventListener("input", handleFilter);
    });
});
</script>

<script>
    document.querySelectorAll('.details').forEach(div => {
    div.innerHTML = div.innerHTML.replace(/(?<!\S)(https?:\/\/[^\s]+|www\.[^\s]+|\b[a-zA-Z0-9.-]+\.(com|net|org|gov|edu|ph)\b)(?!\S)/g, '<a href="http://$1" target="_blank" class="inline blue str500">$1</a>');
});
</script>
<script>
    document.querySelectorAll('.details').forEach(div => {
    div.innerHTML = div.innerHTML.replace(/(^|\s)(#\w+)/g, '$1<span class="green str500">$2</span>');
});
</script>
<script>
document.getElementById("assignBtn").addEventListener("click", function(event) {
    event.preventDefault(); // Prevent default link behavior
    
    let assignCard = document.getElementById("assignDepCard");
    let assignBtn = document.getElementById("assignBtn");

    // Toggle 'active' class
    assignCard.classList.toggle("active");

    // Change button text & icon based on active state
    if (assignCard.classList.contains("active")) {
        assignBtn.innerHTML = '<i class="fas fa-plus"></i>Request Document';
    } else {
        assignBtn.innerHTML = '<i class="fas fa-plus"></i>Request Document';
    }
});

// Hide #assignDepCard when #closeNav is clicked
document.getElementById("closeNav").addEventListener("click", function() {
    let assignCard = document.getElementById("assignDepCard");
    let assignBtn = document.getElementById("assignBtn");

    // Remove 'active' class
    assignCard.classList.remove("active");

    // Reset button text & icon
    assignBtn.innerHTML = '<i class="fas fa-plus"></i>Request Document';
});
</script>

</body>
</html>