<% layout('layout') %>
<style>
    input {
        min-height: 42px;
    }
</style>

<div class="height bgSoft padding10 borderRadius15 relative">
    <a href="/resv/<%= resident._id %>" class="nav absolute left20 top20"><i class="fas fa-chevron-left"></i>Go Back</a>    

<div class="height100 block alignStart overflow-y1" id="assignDepCard" style="overflow-y: auto !important;">
    <div class="height0 padding20">
        <form id="residentForm" action="/update-resident/<%= resident._id %>" method="POST" class="height0 width50 bgWhite padding30 gap0 darkShadow relative borderRadius10">
            <div class="gap5 justifyStart alignStart height0">
                <div class="height0 col justifyStart alignStart">
                    <p class="size30 str500 colorPrimary">Edit Profile</p>

                    <!-- First & Middle Name -->
                    <div class="height0 gap10">
                        <div class="height0 col gap5 alignStart">
                            <label for="">First Name</label>
                            <input type="text" name="firstName" value="<%= resident.firstName %>" required>
                        </div>
                        <div class="height0 col gap5 alignStart">
                            <label for="">Middle Name</label>
                            <input type="text" name="middleName" value="<%= resident.middleName %>">
                        </div>
                    </div>

                    <!-- Last & Ext Name -->
                    <div class="height0 gap10">
                        <div class="height0 col gap5 alignStart">
                            <label for="">Last Name</label>
                            <input type="text" name="lastName" value="<%= resident.lastName %>" required>
                        </div>
                        <div class="height0 col gap5 alignStart">
                            <label for="">Ext Name</label>
                            <input type="text" name="extName" value="<%= resident.extName %>">
                        </div>
                    </div>

                    <!-- House No & Purok -->
                    <div class="height0 gap10">
                        <div class="height0 gap5">
                            <div class="height0 col alignStart">
                                <label for="">House Number</label>
                                <input name="houseNo" type="text" value="<%= resident.houseNo %>" required>
                            </div>
                            <div class="height0 col alignStart">
                                <label for="">Purok</label>
                                <div class="selectBar widthMax100">
                                    <select id="purok" required name="purok">
                                        <% for(let i=1; i<=7; i++){ %>
                                            <option value="Purok <%= i %>" <%= resident.purok === 'Purok ' + i ? 'selected' : '' %>>Purok <%= i %></option>
                                        <% } %>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Birthday -->
                    <label for="">Birthday</label>
                    <div class="height0 gap5">
                        <div class="height0 col alignStart width40">
                            <div class="selectBar widthMax100">
                                <select id="bMonth" required name="bMonth">
                                    <option value="" disabled>Month</option>
                                    <% const months = ["January","February","March","April","May","June","July","August","September","October","November","December"]; %>
                                    <% for(let i=1; i<=12; i++){ %>
                                        <option value="<%= i %>" <%= resident.bMonth == i ? 'selected' : '' %>><%= months[i-1] %></option>
                                    <% } %>
                                </select>
                            </div>
                        </div>
                        <div class="height0 col alignStart width20">
                            <input name="bDay" type="number" id="bDay" min="1" max="31" value="<%= resident.bDay %>" placeholder="Day" required>
                        </div>
                        <div class="height0 col alignStart width40">
                            <input name="bYear" type="number" id="bYear" min="1900" value="<%= resident.bYear %>" placeholder="Year" required>
                        </div>
                    </div>
                    <label class="colorPrimary" id="ageWarning" style="display: none;"></label>

                    <!-- Birth Place -->
                    <div class="height0 col alignStart">
                        <label for="">Birth Place</label>
                        <div class="selectBar widthMin100">
                            <select name="birthPlace" id="birthPlace" required>
                                <option value="">--Select City--</option>
                            </select>
                        </div>
                    </div>

                    <!-- Gender & Civil Status -->
                    <div class="height0 gap10 marginBottom5">
                        <div class="height0 col alignStart">
                            <label for="">Gender</label>
                            <div class="selectBar widthMax100">
                                <select id="gender" name="gender" required>
                                    <option value="Male" <%= resident.gender === 'Male' ? 'selected' : '' %>>Male</option>
                                    <option value="Female" <%= resident.gender === 'Female' ? 'selected' : '' %>>Female</option>
                                </select>
                            </div>
                        </div>
                        <div class="height0 col alignStart">
                            <label for="">Civil Status</label>
                            <div class="selectBar  widthMax100">
                                <select name="civilStatus" id="civilStatus" required>
                                    <option value="Single" <%= resident.civilStatus === 'Single' ? 'selected' : '' %>>Single</option>
                                    <option value="Married" <%= resident.civilStatus === 'Married' ? 'selected' : '' %>>Married</option>
                                    <option value="Widowed" <%= resident.civilStatus === 'Widowed' ? 'selected' : '' %>>Widowed</option>
                                    <option value="Separated" <%= resident.civilStatus === 'Separated' ? 'selected' : '' %>>Separated</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Precinct & Education -->
                    <div class="height0 gap10 marginBottom5">
                        <div class="height0 col alignStart">
                            <label for="">Precinct</label>
                            <div class="selectBar widthMax100">
                                <select name="precinct" id="precinct" required>
                                    <option value="Registered Voter" <%= resident.precinct === 'Registered Voter' ? 'selected' : '' %>>Registered Voter</option>
                                    <option value="Non-Voter" <%= resident.precinct === 'Non-Voter' ? 'selected' : '' %>>Not Registered</option>
                                </select>
                            </div>
                        </div>
                        <div class="height0 col alignStart">
                            <label for="">Education</label>
                            <div class="selectBar widthMax100">
                                <select name="education" id="education" required>
                                    <option value="" disabled>Select</option>
                                    <option value="Elementary" <%= resident.education === 'Elementary' ? 'selected' : '' %>>Elementary</option>
                                    <option value="High School" <%= resident.education === 'High School' ? 'selected' : '' %>>High School</option>
                                    <option value="Vocational" <%= resident.education === 'Vocational' ? 'selected' : '' %>>Vocational</option>
                                    <option value="College" <%= resident.education === 'College' ? 'selected' : '' %>>College</option>
                                    <option value="Post Graduate" <%= resident.education === 'Post Graduate' ? 'selected' : '' %>>Post Graduate</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Nationality & Religion -->
                    <div class="height0 gap10 marginBottom5">
                        <div class="height0 col alignStart">
                            <label for="">Nationality</label>
                            <input type="text" name="nationality" id="nationality" value="<%= resident.nationality %>">
                        </div>
                        <div class="height0 col alignStart">
                            <label for="">Religion</label>
                            <input type="text" name="religion" id="religion" value="<%= resident.religion %>">
                        </div>
                    </div>

                    <!-- Phone & Email -->
                    <div class="height0 gap10 marginBlock15" id="emailField">
                        <div class="height0 col justifyStart alignStart">
                            <label for="">Phone</label>
                            <input type="text" name="phone" id="phone" class="phone" value="<%= resident.phone %>">
                        </div>
                        <div class="height0 col justifyStart alignStart">
                            <label for="">Email</label>
                            <input type="email" name="email" id="email" value="<%= resident.email %>">
                        </div>
                    </div>

                    <br><hr><br>

                    <!-- Solo Parent & Pregnant -->
                    <div class="height0 gap10">
                        <div class="height0 justifyStart alignCenter gap10 paddingInline10 borderRadius10" id="soloParent">
                            <input type="checkbox" class="width0 height0" name="soloParent" <%= resident.soloParent === 'on' ? 'checked' : '' %>>
                            <label for="">Solo Parent (Optional)</label>
                        </div>

                        <div class="height0 justifyStart alignCenter gap10 paddingInline10 borderRadius10" id="pregnantLabel">
                            <input type="checkbox" class="width0 height0" name="pregnant" <%= resident.pregnant === 'on' ? 'checked' : '' %>>
                            <label for="">Pregnant (Optional)</label>
                        </div>
                    </div>

                    <br>

                    <!-- PWD -->
                    <div class="height0 gap10 borderRadius10 paddingBlock5">
                        <div class="height0 justifyStart alignCenter gap10 paddingInline10">
                            <!-- Fix: set checkbox checked attribute properly -->
                            <input type="checkbox" class="width0 height0" id="pwdCheckbox" name="pwd" <%= resident.pwd === 'on' ? 'checked' : '' %>>
                            <label for="">PWD (Optional) </label>
                        </div>
                        <div class="height0 col alignStart">
                            <div class="selectBar">
                                <select id="pwdType" name="pwdType">
                                    <option value="" disabled>Select Disability Type</option>
                                    <% const disabilities = ["Visual","Hearing","Mobility","Mental","Speech","Intellectual","Psychosocial","Learning","Multiple"]; %>
                                    <% disabilities.forEach(d => { %>
                                        <option value="<%= d %>" <%= resident.pwdType === d ? 'selected' : '' %>><%= d %></option>
                                    <% }) %>
                                </select>
                            </div>
                        </div>
                    </div>

                    <br><hr><br>

                    <!-- Employment -->
                    <div class="height0 gap10">
                        <div class="height0 col gap5 alignStart">
                            <label for="">Working Status</label>
                            <div class="selectBar">
                                <select id="employmentStatus" name="employmentStatus" required>
                                    <option value="Unemployed" <%= resident.employmentStatus === 'Unemployed' ? 'selected' : '' %>>Unemployed</option>
                                    <option value="Employed" <%= resident.employmentStatus === 'Employed' ? 'selected' : '' %>>Employed</option>
                                    <option value="Self-Employed" <%= resident.employmentStatus === 'Self-Employed' ? 'selected' : '' %>>Self-Employed</option>
                                </select>
                            </div>
                        </div>
                        <div class="height0 col gap5 alignStart borderRadius10 padding5" id="workField">
                            <label for="">Work or Source of Income</label>
                            <input type="text" id="work" name="work" value="<%= resident.work %>">
                        </div>
                    </div>

                    <!-- Position -->
                    <div class="height0 gap5">
                        <br>
                        <div class="height0 col gap5 alignStart">
                            <label for="">Position</label>
                            <div class="selectBar widthMin100">
                                <select name="position" id="position">
                                    <option value="Resident" <%= resident.position === 'Resident' ? 'selected' : '' %>>Resident</option>
                                    <option value="Punong Barangay" <%= resident.position === 'Punong Barangay' ? 'selected' : '' %>>Punong Barangay</option>
                                    <option value="Barangay Secretary" <%= resident.position === 'Barangay Secretary' ? 'selected' : '' %>>Barangay Secretary</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <br>
                    <div class="height0 justifyEnd"><button type="submit" class="nav">Save Changes</button></div>
                </div>
            </div>
        </form>

        <script>
            // Fill birthPlace dynamically & keep selected
            const cities = [
                "Alaminos","Angeles","Antipolo","Bacolod","Bacoor","Bago","Baguio",
                "Bais","Balanga","Batac","Batangas City","Bayawan","Baybay","Bayugan",
                "Biñan","Bislig","Bogo","Borongan","Bulacan","Butuan","Cabadbaran",
                "Cabanatuan","Cabuyao","Cadiz","Cagayan de Oro","Calaca","Calamba",
                "Calapan","Calbayog","Caloocan","Candon","Canlaon","Carcar","Carmona",
                "Catbalogan","Cauayan","Cavite City","Cebu City","Cotabato City",
                "Dagupan","Danao","Dapitan","Dasmariñas","Davao City","Digos",
                "Dipolog","Dumaguete","El Salvador","Escalante","Gapan","General Santos",
                "General Trias","Gingoog","Guihulngan","Himamaylan","Ilagan","Iligan",
                "Iloilo City","Imus","Iriga","Isabela","Kabankalan","Kidapawan",
                "Koronadal","La Carlota","Lamitan","Laoag","Lapu-Lapu","Las Piñas",
                "Legazpi","Ligao","Lipa","Lucena","Maasin","Mabalacat","Makati",
                "Malabon","Malaybalay","Malolos","Mandaluyong","Mandaue","Manila",
                "Marawi","Marikina","Masbate City","Mati","Meycauayan","Muñoz",
                "Muntinlupa","Naga","Navotas","Olongapo","Ormoc","Oroquieta","Ozamiz",
                "Pagadian","Palayan","Panabo","Parañaque","Pasay","Pasig","Passi",
                "Puerto Princesa","Quezon City","Roxas","Sagay","Samal","San Carlos",
                "San Fernando","San Jose","San Jose del Monte","San Pablo","San Pedro",
                "Santa Rosa","Santo Tomas","Santiago","Silay","Sipalay","Sorsogon City",
                "Surigao City","Tabaco","Tabuk","Tacloban","Tacurong","Tagaytay",
                "Tagbilaran","Taguig","Tagum","Talisay","Tanauan","Tandag","Tangub",
                "Tanjay","Tarlac City","Tayabas","Toledo","Trece Martires","Tuguegarao",
                "Urdaneta","Valencia","Valenzuela","Victorias","Vigan","Zamboanga City"
            ];
            const birthPlaceSelect = document.getElementById("birthPlace");
            const selectedCity = <%- JSON.stringify(resident.birthPlace || '') %>;

            cities.forEach(city => {
                let option = document.createElement("option");
                option.value = city;
                option.textContent = city;
                if (city === selectedCity) option.selected = true;
                birthPlaceSelect.appendChild(option);
            });
        </script>
    </div>
</div>

        
        
    </div>
</div>
